<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì»¤ë®¤ë‹ˆí‹° ê¸€ì“°ê¸°</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="nav.css">
    <style>
        body {
            margin: 0;
            background: #EDEDED;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .app {
            width: 380px;
            height: 750px;
            background: #FFFFFF;
            border-radius: 16px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 67px;
            background-image: url('../ì´ë¯¸ì§€/ìƒë‹¨ë°”.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 1000;
        }

        .container {
            position: relative;
            width: 375px;
            height: 812px;
            margin: 0 auto;
            border: 1px solid #ccc;
        }

        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 24px;
        }

        .header {
            position: absolute;
            top: 50px;
            left: 16px;
            right: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-weight: 600;
            position: absolute;
            top: 1px;
            right: 140px;
            font-size: 18px;
            text-align: center;
            flex: 1;
        }

        .select-topic {
            position: absolute;
            top: 90px;
            left: 20px;
            right: 20px;
            font-size: 16px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        .dropdown {
            display: none;
            position: absolute;
            top: 140px;
            left: 20px;
            width: calc(100% - 40px);
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 10;
        }

        .dropdown-item {
            padding: 10px;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .warning-box {
            position: absolute;
            top: 140px;
            left: 20px;
            right: 20px;
            background-color: #FBEED8;
            border-radius: 2px;
            padding: 10px;
            font-size: 12px;
            font-weight: bold;
            color: #FF963B;
        }

        .warning-box .close {
            position: absolute;
            top: 5px;
            /* left: 20px; */
            right: 10px;
            color: #FEAC62;
            font-size: 16px;
            cursor: pointer;
        }


        #titleInput {
            position: absolute;
            top: 210px;
            left: 20px;
            right: 20px;
            height: 35px;
            font-size: 16px;
            padding: 5px 10px;
            background-color: #fcfcfc;
            border: 2px solid #e49b9b;
            border-radius: 10px;
            box-sizing: border-box;
        }

        .text-area {
            position: absolute;
            top: 260px;
            left: 20px;
            right: 20px;
            height: 360px;
            border: none;
            font-size: 16px;
            color: #000;
            background-color: #dbdbdb;
            padding: 10px;
            resize: none;
        }

        #saveBtn {
            position: absolute;
            bottom: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 340px;
            height: 40px;
            background-color: #e49b9b;
            color: white;
            text-align: center;
            line-height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            z-index: 100;
        }

        .footer {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer .left {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 16px;
        }

        .footer .button {
            width: 65px;
            height: 33px;
            border-radius: 5px;
            font-size: 13px;
            text-align: center;
            line-height: 33px;
            cursor: pointer;
        }

        .temp-btn {
            background-color: #B5B0B0;
            color: #fff;
        }

        .post-btn {
            background-color: #F6D3D3;
            color: #000;
        }

        /* SweetAlert2 íŒì—… í¬ê¸° ì¡°ì ˆ */
        .swal2-popup {
            font-size: 14px !important;
            width: 300px !important;
            padding-top: 5px;
            border-radius: 12px !important;
        }

        .swal2-title {
            font-size: 16px !important;
        }

        .swal2-html-container {
            font-size: 14px !important;
        }

        .swal2-confirm {
            font-size: 14px !important;
            padding: 6px 14px !important;
            border-radius: 8px !important;
        }

        /* info, warning, error ì•„ì´ì½˜ ë‚´ë¶€ í…ìŠ¤íŠ¸ ì¤„ì´ê¸° */
        .swal2-icon.swal2-warning,
        .swal2-icon.swal2-success,
        .swal2-icon.swal2-info,
        .swal2-icon.swal2-error {
            font-size: 10px !important;
            line-height: 45px !important;
        }
    </style>
</head>

<body>
    <div class="app">
        <div class="header-image"></div>
        <div class="container">
            <div class="status-bar"></div>

            <div class="header">
                <span style="cursor:pointer;">â†</span>
                <div class="header-title">ì»¤ë®¤ë‹ˆí‹°</div>
                <span style="width: 20px;"></span>
            </div>

            <div class="select-topic" id="selectTopicBtn">
                ê²Œì‹œê¸€ì˜ ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.â–¼
            </div>


            <div class="dropdown" id="topicDropdown">
                <div class="dropdown-item" data-value="ëŒ€ì¸ê´€ê³„">ëŒ€ì¸ê´€ê³„</div>
                <div class="dropdown-item" data-value="ì¹œêµ¬">ì¹œêµ¬</div>
                <div class="dropdown-item" data-value="ê°€ì¡±">ê°€ì¡±</div>
                <div class="dropdown-item" data-value="í•™ì—…/ì§„ë¡œ">í•™ì—…/ì§„ë¡œ</div>
                <div class="dropdown-item" data-value="í•™êµ">í•™êµ</div>
            </div>


            <div class="warning-box">
                <div>ê¸€ ì‘ì„±í•˜ê¸° ì „ì— ì•Œë ¤ë“œë ¤ìš”.</div>
                <div>ìš•ì„¤ì´ë‚˜ ëˆ„êµ°ê°€ê°€ íŠ¹ì •ë˜ëŠ” ê¸€ì„ ì˜¬ë¦´ ìˆ˜ ì—†ì–´ìš”.</div>
                <div>ì»¤ë®¤ë‹ˆí‹°ì˜ ê¸€ì€ ìƒë‹´ì‚¬ ë¶„ë“¤ ìˆ˜ì‹œë¡œ ëª¨ë‹ˆí„°ë§ í•˜ê³  ìˆì–´ìš”.</div>
                <div class="close">X</div>
            </div>

            <input type="text" id="titleInput" placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
                style="position: absolute; top: 220px; left: 20px; right: 20px; height: 35px; font-size: 16px; padding: 5px 10px; border:2px solid #e49b9b;; background-color: #fcfcfc; border-radius: 10px; box-sizing: border-box;" />

            <textarea id="contentInput" class="text-area" placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ì¨ì£¼ì„¸ìš”."></textarea>

            <div class="footer">
                <div class="left">
                    <img src="icon_image.png" alt="image" width="24" height="24" />
                    <div>0/10</div>
                    <img src="icon_link.png" alt="link" width="24" height="24" />
                    <div>0/10</div>
                </div>
                <div class="button temp-btn">ì„ì‹œì €ì¥</div>
                <div class="button post-btn">í¬ìŠ¤íŒ…</div>
            </div>
        </div>
        <div id="saveBtn"
            style="position: absolute; bottom: 65px; left: 50%; transform: translateX(-50%); width: 340px; height: 40px; background-color: #e49b9b; color: white; text-align: center; line-height: 40px; border-radius: 8px; cursor: pointer; font-weight: bold; z-index: 2000;">
            ì €ì¥í•˜ê¸°
        </div>
        <div class="nav-placeholder"></div>

        <nav id="bottom-nav">
            <a href="main1.html" class="nav-item">
                <span class="material-icons">home</span>
                <span class="nav-label">í™ˆ</span>
            </a>
            <a href="ì»¤ë®¤ë‹ˆí‹°.html" class="nav-item active">
                <span class="material-icons">people</span>
                <span class="nav-label">ì»¤ë®¤ë‹ˆí‹°</span>
            </a>
            <a href="test_0526.html" class="nav-item">
                <span class="material-icons">chat</span>
                <span class="nav-label">AIìƒë‹´</span>
            </a>
            <a href="emo_main.html" class="nav-item">
                <span class="material-icons">mood</span>
                <span class="nav-label">ê°ì •ì²´í¬</span>
            </a>
            <a href="mypage_main.html" class="nav-item">
                <span class="material-icons">person</span>
                <span class="nav-label">ë‚´ì •ë³´</span>
            </a>
        </nav>


    </div>

    <script>
        const supabase = window.supabase.createClient(
            "https://fszwgldiafcffgbbtlwo.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzendnbGRpYWZjZmZnYmJ0bHdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc2ODE1NjAsImV4cCI6MjA2MzI1NzU2MH0.ZznTYaj-KNjyzZHFwm03X7J3S9XLZrHkCi10XAcQ1JI"
        );

        const user_id = localStorage.getItem("user_id");
        const selectTopicBtn = document.getElementById("selectTopicBtn");
        const dropdown = document.getElementById("topicDropdown");
        const titleInput = document.getElementById("titleInput");
        const contentInput = document.getElementById("contentInput");
        const saveBtn = document.getElementById("saveBtn");

        let selectedCategory = null;

        // ì£¼ì œ ë“œë¡­ë‹¤ìš´ ì—´ê¸°
        selectTopicBtn.addEventListener("click", () => {
            dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
        });

        // ì£¼ì œ ì„ íƒ
        document.querySelectorAll(".dropdown-item").forEach(item => {
            item.addEventListener("click", () => {
                selectedCategory = item.dataset.value;
                selectTopicBtn.textContent = selectedCategory + " â–¼";
                dropdown.style.display = "none";
            });
        });

        // ì €ì¥
        saveBtn.addEventListener("click", async () => {
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();

            if (!user_id) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            if (!selectedCategory) return Swal.fire({
                icon: 'warning',
                title: 'ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”',
                text: 'ì£¼ì œë¥¼ ì„ íƒí•´ì•¼ ê¸°ë¡í•  ìˆ˜ ìˆì–´ìš”!',
                confirmButtonColor: '#5E61FF'
            });
            if (!title) return Swal.fire({
                icon: 'warning',
                title: 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”ğŸ˜Š',
                text: 'ì œëª©ì„ ì…ë ¥í•´ì•¼ ê¸°ë¡í•  ìˆ˜ ìˆì–´ìš”!',
                confirmButtonColor: '#5E61FF'
            });
            if (!content) return Swal.fire({
                icon: 'warning',
                title: 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”ğŸ˜Š',
                text: 'ë‚´ìš©ì„ ì…ë ¥í•´ì•¼ ê¸°ë¡í•  ìˆ˜ ìˆì–´ìš”!',
                confirmButtonColor: '#5E61FF'
            });

            const { data, error } = await supabase.from("community").insert([
                {
                    user_id,
                    title,
                    content,
                    category: selectedCategory,
                    writeTime: new Date().toISOString()
                }
            ]).select();

            if (error) {
                console.error(error);
                alert("ì €ì¥ ì‹¤íŒ¨!");
            } else {
                const commu_id = data[0].commu_id; // ì €ì¥ëœ ê¸€ì˜ commu_id ì¶”ì¶œ

                Swal.fire({
                    icon: 'success',
                    title: 'ê²Œì‹œê¸€ì´ ì‘ì„± ì™„ë£ŒğŸ˜Š',
                    text: 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆì–´ìš”!',
                    confirmButtonColor: '#5E61FF',
                    allowOutsideClick: false,
                    backdrop: true,
                    heightAuto: false
                }).then(() => {
                    window.location.href = `ê²Œì‹œê¸€2.html?id=${commu_id}`; // ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                });
                titleInput.value = "";
                contentInput.value = "";
                selectTopicBtn.textContent = "ê²Œì‹œê¸€ì˜ ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” â–¼";
                selectedCategory = null;
            }
        });
    </script>
</body>

</html>